{"version":3,"file":"metadata-xform.js","names":["XmlStream","require","BaseXform","MetadataXform","render","xmlStream","model","valueMetadata","count","length","openXml","StdDocAttributes","openNode","xmlns","leafNode","name","minSupportedVersion","copy","pasteAll","pasteValues","merge","splitFirst","rowColShift","clearFormats","clearComments","assign","coerce","closeNode","futureCount","i","uri","forEach","entry","t","v","rvIndex","module","exports"],"sources":["../../../../../lib/xlsx/xform/richvalue/metadata-xform.js"],"sourcesContent":["const XmlStream = require('../../../utils/xml-stream');\nconst BaseXform = require('../base-xform');\n\nclass MetadataXform extends BaseXform {\n  render(xmlStream, model) {\n    const valueMetadata = (model && model.valueMetadata) || [];\n    const count = valueMetadata.length;\n\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n    xmlStream.openNode('metadata', {\n      xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\n      'xmlns:xlrd': 'http://schemas.microsoft.com/office/spreadsheetml/2017/richdata',\n    });\n\n    xmlStream.openNode('metadataTypes', {count: 1});\n    xmlStream.leafNode('metadataType', {\n      name: 'XLRICHVALUE',\n      minSupportedVersion: '120000',\n      copy: '1',\n      pasteAll: '1',\n      pasteValues: '1',\n      merge: '1',\n      splitFirst: '1',\n      rowColShift: '1',\n      clearFormats: '1',\n      clearComments: '1',\n      assign: '1',\n      coerce: '1',\n    });\n    xmlStream.closeNode(); // metadataTypes\n\n    const futureCount = count;\n    xmlStream.openNode('futureMetadata', {name: 'XLRICHVALUE', count: futureCount});\n    for (let i = 0; i < count; i++) {\n      xmlStream.openNode('bk');\n      xmlStream.openNode('extLst');\n      xmlStream.openNode('ext', {uri: '{3e2802c4-a4d2-4d8b-9148-e3be6c30e623}'});\n      xmlStream.leafNode('xlrd:rvb', {i});\n      xmlStream.closeNode(); // ext\n      xmlStream.closeNode(); // extLst\n      xmlStream.closeNode(); // bk\n    }\n    xmlStream.closeNode(); // futureMetadata\n\n    xmlStream.openNode('valueMetadata', {count});\n    valueMetadata.forEach(entry => {\n      xmlStream.openNode('bk');\n      xmlStream.leafNode('rc', {t: 1, v: entry.rvIndex});\n      xmlStream.closeNode(); // bk\n    });\n    xmlStream.closeNode(); // valueMetadata\n\n    xmlStream.closeNode(); // metadata\n  }\n}\n\nmodule.exports = MetadataXform;\n"],"mappings":";;AAAA,MAAMA,SAAS,GAAGC,OAAO,CAAC,2BAA2B,CAAC;AACtD,MAAMC,SAAS,GAAGD,OAAO,CAAC,eAAe,CAAC;AAE1C,MAAME,aAAa,SAASD,SAAS,CAAC;EACpCE,MAAMA,CAACC,SAAS,EAAEC,KAAK,EAAE;IACvB,MAAMC,aAAa,GAAID,KAAK,IAAIA,KAAK,CAACC,aAAa,IAAK,EAAE;IAC1D,MAAMC,KAAK,GAAGD,aAAa,CAACE,MAAM;IAElCJ,SAAS,CAACK,OAAO,CAACV,SAAS,CAACW,gBAAgB,CAAC;IAC7CN,SAAS,CAACO,QAAQ,CAAC,UAAU,EAAE;MAC7BC,KAAK,EAAE,2DAA2D;MAClE,YAAY,EAAE;IAChB,CAAC,CAAC;IAEFR,SAAS,CAACO,QAAQ,CAAC,eAAe,EAAE;MAACJ,KAAK,EAAE;IAAC,CAAC,CAAC;IAC/CH,SAAS,CAACS,QAAQ,CAAC,cAAc,EAAE;MACjCC,IAAI,EAAE,aAAa;MACnBC,mBAAmB,EAAE,QAAQ;MAC7BC,IAAI,EAAE,GAAG;MACTC,QAAQ,EAAE,GAAG;MACbC,WAAW,EAAE,GAAG;MAChBC,KAAK,EAAE,GAAG;MACVC,UAAU,EAAE,GAAG;MACfC,WAAW,EAAE,GAAG;MAChBC,YAAY,EAAE,GAAG;MACjBC,aAAa,EAAE,GAAG;MAClBC,MAAM,EAAE,GAAG;MACXC,MAAM,EAAE;IACV,CAAC,CAAC;IACFrB,SAAS,CAACsB,SAAS,CAAC,CAAC,CAAC,CAAC;;IAEvB,MAAMC,WAAW,GAAGpB,KAAK;IACzBH,SAAS,CAACO,QAAQ,CAAC,gBAAgB,EAAE;MAACG,IAAI,EAAE,aAAa;MAAEP,KAAK,EAAEoB;IAAW,CAAC,CAAC;IAC/E,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGrB,KAAK,EAAEqB,CAAC,EAAE,EAAE;MAC9BxB,SAAS,CAACO,QAAQ,CAAC,IAAI,CAAC;MACxBP,SAAS,CAACO,QAAQ,CAAC,QAAQ,CAAC;MAC5BP,SAAS,CAACO,QAAQ,CAAC,KAAK,EAAE;QAACkB,GAAG,EAAE;MAAwC,CAAC,CAAC;MAC1EzB,SAAS,CAACS,QAAQ,CAAC,UAAU,EAAE;QAACe;MAAC,CAAC,CAAC;MACnCxB,SAAS,CAACsB,SAAS,CAAC,CAAC,CAAC,CAAC;MACvBtB,SAAS,CAACsB,SAAS,CAAC,CAAC,CAAC,CAAC;MACvBtB,SAAS,CAACsB,SAAS,CAAC,CAAC,CAAC,CAAC;IACzB;IACAtB,SAAS,CAACsB,SAAS,CAAC,CAAC,CAAC,CAAC;;IAEvBtB,SAAS,CAACO,QAAQ,CAAC,eAAe,EAAE;MAACJ;IAAK,CAAC,CAAC;IAC5CD,aAAa,CAACwB,OAAO,CAACC,KAAK,IAAI;MAC7B3B,SAAS,CAACO,QAAQ,CAAC,IAAI,CAAC;MACxBP,SAAS,CAACS,QAAQ,CAAC,IAAI,EAAE;QAACmB,CAAC,EAAE,CAAC;QAAEC,CAAC,EAAEF,KAAK,CAACG;MAAO,CAAC,CAAC;MAClD9B,SAAS,CAACsB,SAAS,CAAC,CAAC,CAAC,CAAC;IACzB,CAAC,CAAC;IACFtB,SAAS,CAACsB,SAAS,CAAC,CAAC,CAAC,CAAC;;IAEvBtB,SAAS,CAACsB,SAAS,CAAC,CAAC,CAAC,CAAC;EACzB;AACF;AAEAS,MAAM,CAACC,OAAO,GAAGlC,aAAa","ignoreList":[]}